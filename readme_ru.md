# Expo Client [![CircleCI](https://circleci.com/gh/expo/expo.svg?style=svg)](https://circleci.com/gh/expo/expo) [![Forums](https://img.shields.io/badge/expo-forum-blue.svg)](https://forums.expo.io)

Expo - это набор инструментов, библиотек и сервисов, которые позволяют создавать собственные приложения для iOS и Android с помощью JavaScript. Этот репозиторий предназначен для разработки клиентского программного обеспечения Expo и включает в себя клиентские приложения, модули, приложения и многое другое.

[Нажмите здесь, чтобы посмотреть нашу документацию](https://docs.expo.io) для разработки на Expo. Если вы новичок в сообществе Экспо, [нажмите здесь, чтобы просмотреть Принципы сообщества Экспо](https://expo.io/guidelines). Спасибо за помощь в сохранении открытости и гостеприимства сообщества Экспо!

## Вступление

Это исходный код клиентского приложения Expo, который используется для просмотра событий, опубликованных в сервисе Expo. Если вы хотите собрать и установить клиент Expo прямо на устройстве, вы находитесь в правильном месте. Обратите внимание, что если вы просто хотите установить клиентское приложение Expo на симуляторе, вам не нужно создавать его из исходного кода. Вместо этого вы должны [следовать инструкциям здесь](https://docs.expo.io/versions/latest/introduction/installation.html).

Чтобы создать клиентское приложение Expo, следуйте инструкциям в разделе [Настройка](#set-up) ниже. Используйте командную строку [expo-cli](https://docs.expo.io/versions/latest/workflow/expo-cli), чтобы использовать инфраструктуру Expo для создания вашего приложения.

Пожалуйста, спросите нас на [форумах](https://forums.expo.io/), если вы застряли.

**Отказ (Disclaimers)**:

Если вы хотите создать отдельное приложение, которое имеет собственный значок и имя, см. [Наша документацию здесь](https://docs.expo.io/versions/latest/guides/building-standalone-apps.html). Вы находитесь не в том месте, вам не нужно создавать клиентов Expo из исходного кода.

Если вам нужно внести изменения в собственный код вашего проекта Expo, например добавить собственные модули, мы можем [создать собственный проект для вас] (https://docs.expo.io/versions/latest/expokit/eject). Вы находитесь не в том месте, вам не нужно создавать клиентов Expo из исходного кода.

## Настройка

Примечание. Мы поддерживаем сборку клиентов только на macOS.

- Установите [nix](https://nixos.org/nix) (в настоящее время `curl https://nixos.org/nix/install | sh`)
- Установите [direnv](http://direnv.net/) (чтобы сделать это с nix, запустите `nix-env -iA nixpkgs.direnv`)
- Клонируйте этот репо; мы рекомендуем клонировать его в каталог, полный путь которого не содержит пробелов (вы должны клонировать все подмодули с помощью `git clone --recurse-submodules`)
- Запустите `yarn` в каталоге` tools-public`.

#### iOS
- Убедитесь, что у вас установлен последний не бета-код Xcode.
- Запустите `git lfs pull`.
- Запустите `. / Generate-files-ios.js` в каталоге `tools-public`.
- Откройте и запустите `ios / Exponent.xcworkspace` в Xcode.

#### Android
- Убедитесь, что у вас установлена Android Studio 3
- Запустите `android / install-ndk-17c.sh`, чтобы получить требуемую версию Android NDK.
- См. «Запуск на устройстве»

## Запуск на устройстве

### iOS
- В строке меню Xcode откройте раскрывающееся меню **Xcode** и выберите **Настройки**. Затем на вкладке **Учетные записи** в меню настроек добавьте свою личную или командную учетную запись разработчика Apple.
- Подключите тестовое устройство к компьютеру с помощью USB-кабеля.
- В строке меню Xcode откройте раскрывающееся меню **Product**, выберите **Destination**, затем в группе _Device_ выберите свое устройство.
- В навигаторе проекта выберите проект **Exponent**, чтобы вызвать параметры проекта, а затем:
- На вкладке **General** в разделе **Identity** введите уникальный идентификатор пакета.
- Также на вкладке **General**, в разделе **Signing**, выберите свою личную или командную учетную запись разработчика Apple в качестве **Team** и создайте новый сертификат подписи, нажав **Fix Issue** ,
- Наконец, запустить сборку

### Android
- Если на тестовом устройстве установлена ​​версия Play Store приложения Expo Client, удалите его.
- Подключите тестовое устройство к компьютеру с помощью USB-кабеля.
- Запустите `fastlane android start` или поочередно откройте каталог `android` в Android Studio, запустите его и в диалоговом окне **Select Deployment Target** выберите свое устройство.

## Автономные приложения

Если вам не нужен собственный встроенный код за пределами Expo SDK, перейдите к [нашей документации по созданию автономных приложений без использования Android Studio и Xcode](https://docs.expo.io/versions/latest/guides/building -standalone-apps.html).

Если вы все еще здесь, обязательно следуйте разделу [Configure app.json](https://docs.expo.io/versions/latest/guides/building-standalone-apps.html#2-configure-appjson) в документации, прежде чем продолжить. Вам нужно будет добавить соответствующие поля в ваш app.json, прежде чем можно будет запускать скрипты автономного приложения. После этого перейдите к инструкциям для конкретной платформы.

#### Android

Скрипт автономного приложения для Android создает новый каталог `android-shell-app` с измененным проектом Android. Затем он компилирует этот новый каталог, давая вам подписанный или неподписанный `.apk` в зависимости от того, предоставили ли вы хранилище ключей и необходимые пароли. Если есть проблемы с приложением, вы можете открыть проект `android-shell-app` в Android Studio для отладки.

Вот шаги для создания автономного приложения для Android:
- Опубликуйте свой экземпляр с Expo CLI. Обратите внимание на опубликованный URL.
- `cd tools-public`.
- Если вы хотите подписать `.apk`, запустите `gulp android-shell-app --url [опубликованный URL-адрес экземпляра] --sdkVersion [sdk-версия вашего экземпляра] --keystore [путь к хранилищу ключей] --alias [псевдоним хранилища ключей] --keystorePassword [пароль хранилища ключей] --keyPassword [пароль ключа] --workingDir = ../ `.
- Если вам не нужен подписанный `.apk`, запустите `gulp android-shell-app --url [опубликованный URL-адрес экземпляра] --sdkVersion [версия SDK вашего экземпляра] --workingDir = ../ `.
- Файл `.apk` будет находиться в `/tmp/shell-signature.apk` для подписанного `.apk` или в `/tmp/shell-debug.apk` для неподписанного `.apk`.
- `adb install` файл `.apk` для его проверки.
- Загрузите в Play Store!

#### iOS

Скрипт автономного приложения для iOS имеет два действия: `build` и` configure`. `build` создает архив или сборку симулятора рабочей области Expo iOS. `configure` принимает путь к существующему архиву и изменяет все его файлы конфигурации, так что он будет работать как автономный экземпляр Expo, а не как клиентское приложение Expo.

Вот шаги для создания отдельного приложения для iOS:
- Опубликуйте свой экземпляр с Expo CLI. Обратите внимание на опубликованный URL.
- `cd tools-public`.
- `gulp ios-shell-app - action build --type [симулятор или архив] --configuration [Debug или Release]`
- Полученный архив будет создан в `../shellAppBase- [type]`.
- `gulp ios-shell-app --url [опубликованный URL-адрес экземпляра] - action configure --type [симулятор или архив] --archivePath [путь к ExpoKitApp.app] --sdkVersion [версия sdk вашего экземпляра] --output your-app.tar.gz`
- Этот пакет не подписан и не может быть отправлен в iTunes Connect как есть; вам нужно будет вручную подписать его, если вы хотите отправить его в Apple. [Fastlane](https://fastlane.tools/) является хорошим вариантом для этого. Кроме того, [Expo сделает это за вас](https://docs.expo.io/versions/latest/guides/building-standalone-apps.html), если вам не нужно создавать этот проект из исходного кода.
- Если вы создали сборку симулятора на первом шаге, распакуйте tar.gz, используя `tar -xvzf your-app.tar.gz`. Затем вы можете запустить его на iPhone Simulator с помощью `xcrun simctl install bootted <app path>` и `xcrun simctl launch bootted <app identifier>`. Другая альтернатива, которую предпочитают некоторые люди, - установить инструмент [ios-sim](https://github.com/phonegap/ios-sim) и затем использовать `ios-sim launch <app path>`.
- Есть несколько дополнительных флагов, которые вы можете передать этому сценарию. Все они описаны в комментариях к блоку внутри `xdl/src/detach/IosShellApp.js`.

## Изменение кода JS
Клиентские приложения Expo запускают корневой проект Expo в дополнение к собственному коду. По умолчанию будет использоваться опубликованная версия проекта, поэтому любые изменения, внесенные в каталог `home`, не будут отображаться без дополнительной работы.

Запустите этот проект локально, выполнив `expo start` из каталога `home`. В iOS вам дополнительно нужно установить для `DEV_KERNEL_SOURCE` значение `LOCAL` в файле `EXBuildConstants.plist` (по умолчанию это `PUBLISHED`).

У нативных проектов Android Studio и XCode есть хук сборки, который найдет это, если работает `expo start`. Продолжайте работу и пересоберите приложение на каждой платформе.

## Макет проекта

- `android` содержит проект Android.
- `home` содержит исходный код JavaScript приложения.
- `ios` содержит проект iOS.
- `ios/Exponent.xcworkspace` - это рабочее пространство Xcode. Всегда открывайте это вместо `Exponent.xcodeproj`, потому что рабочая область также загружает зависимости CocoaPods.
- `tools-public` содержит инструменты для сборки и настройки.
- `template-files` содержит шаблоны для файлов, которые требуют закрытых ключей. Они заполняются с помощью ключей в `template-files/keys.json`.
- `template-files/ios/dependencies.json` определяет зависимости CocoaPods приложения.

## Тесты

### iOS

Для собственных модульных тестов XCTest:

- Нажмите Command+U в XCode, чтобы собрать и протестировать `Tests` с назначением модульное тестирование.
- Или запустите `fastlane ios test` из родительского каталога `ios`.

Для тестов интеграции JS протестируйте назначение `ExponentIntegrationTests` (не входит в схему тестирования по умолчанию). Это назначение необходимо, чтобы вы сконфигурировали `EXTestEnvironment.plist` с ключом `testSuiteUrl`, значением которого является URL-адрес для загрузки какой-либо версии приложения [test-suite](apps/test-suite) из Expo. Это запустит кучу тестов Jasmine против Expo SDK.

## Содействие
Пожалуйста, свяжитесь с нами, прежде чем начинать работу в Pull Request! Зачастую поддерживать код сложнее, чем писать. Лучшее место для общения с нами - это Slack на https://slack.expo.io.

## Лицензия
Исходный код Expo предоставляется по лицензии [MIT](ЛИЦЕНЗИЯ). Некоторые зависимости лицензируются по-разному, например, с лицензией BSD.

